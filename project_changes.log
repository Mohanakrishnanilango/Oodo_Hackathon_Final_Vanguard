# Project Changes Log

## [2026-02-08]
### Shop Page Enhancements
- Replaced static category text with interactive toggle buttons and filtering logic.
- Added hover overlays to product cards with "Buy Now" and "Add Cart" actions.
- Integrated product images (mock) into the marketplace grid.

### Checkout Flow Implementation
- Enhanced `CartPage.jsx` with a multi-step checkout: Review -> Shipping -> Payment.
- In Shipping: Added detailed billing summary and tax calculation (12% GST).
- In Payment: Implemented a GPay QR mockup with a 5-second automatic verification timer.
- Added "Order completing..." transition state before navigating to order history.
### [2026-02-08] Refinements
- **Guided Checkout**: Locked Shipping and Payment tabs in `CartPage.jsx` until previous steps are completed.
- **Dynamic Header**: Implemented real-time cart count in `PortalHeader.jsx` using a custom event listener (`cartUpdate`).
- **Shop UI Cleanup**: Removed the redundant category dropdown from `ShopPage.jsx` and added a visual active-category label.
- **Cart Sync**: All cart additions and removals now trigger a header refresh.
### [2026-02-08] UI Polish & Sorting
- **Functional Sorting**: Implemented "Price: Low to High", "Price: High to Low", and "Newest Arrivals" logic in the Shop.
- **Improved Visuals**: Upgraded product placeholders with high-quality, domain-specific technology images from Unsplash.
- **Black Text Theme**: Standardized all primary and descriptive text to pure black (#000000) for enhanced clarity and contrast.
- **Dropdown Refinement**: Updated the sort dropdown to be fully interactive and visually consistent with the new theme.

### [2026-02-08] Product Detail Transition
- **Removed Hover Actions**: The product grid no longer displays action buttons on hover, favoring a cleaner browsing experience.
- **Dedicated Detail View**: Clicking a product now opens a comprehensive detail section with high-quality imagery and descriptions.
- **Subscription Tier Selection**: Integrated tiered plan selection: Weekly (Standard), Monthly (Premium), and Yearly (Premium Pro) with dynamic pricing.
- **Action Migration**: Relocated "Buy Now" and "Add Cart" buttons to the detailed view for context-aware purchasing.

### [2026-02-08] Bug Fixes & Content Cleanup
- **Cart Progression Validation**: Fixed a bug where users could navigate to Shipping/Payment pages even with an empty cart. Integrated strict validation to block progression.
- **Visual Content Refresh**: Replaced all human-centric product images with strictly non-living technology visuals (servers, code, microchips) to maintain a professional, corporate SaaS aesthetic.

### [2026-02-08] Product Page Migration
- **Architectural Shift**: Transitioned from an inline product detail view in `ShopPage.jsx` to a standalone `ProductPage.jsx`.
- **Dynamic Routing**: Enabled `/portal/product/:id` routing to handle specific product deep-links.
- **Subscription Porting**: Migrated the Weekly/Monthly/Yearly subscription logic to the dedicated page.
- **Visual Consistency**: Applied the professional non-living tech imagery and pure black text theme to the new standalone page.

### [2026-02-08] Cart Sync & Coupon Validation
- **Cart Persistence Fix**: Migrated `CartPage.jsx` from backend API to `localStorage` synchronization. This ensures that adding or removing products works consistently across the entire application.
- **Strict Coupon Logic**: Implemented validation for coupon codes. Only `FIRST`, `SECOND`, and `THIRD` are now accepted; empty or invalid codes are rejected with a user notification.

### [2026-02-08] Authentication Integration & Role-Based Routing
- **New Auth Service**: Ports the robust `authService.js` to JavaScript, providing managed methods for login, registration, and persistent sessions.
- **Role-Based Redirects**: Implemented a global `RoleBasedRedirect` logic. Admins and Staff are routed to the Internal Dashboard, while Customers are directed to the Portal.
- **LoginPage Overhaul**: Refactored the login screen with a sleek new design, including integrated Registration and Forgot Password (OTP) flows.
- **Session Persistence**: Secured the application so that user roles and details are correctly retrieved from storage on every page refresh or dashboard visit.
- **Database Schema Alignment**: Developed and applied `fix_schema.js` and `init_db.js` to resolve column naming conflicts and ensure the `users` and `password_resets` tables match the required specifications.

### [2026-02-08] Dashboard & Payments Refinement
- **Real Transaction Tracking**: Replaced mock checkout logic with a robust `POST /orders/complete` API that records subscriptions, paid invoices, and real-time payments in the database.
- **Dynamic Payment History**: Refactored `PaymentHistory.js` to fetch and display the live transaction log from the server, removing all hardcoded entries.
- **Role-Based Branding**: Updated the Internal Dashboard to dynamically display "Admin Dashboard" or "Staff Dashboard" based on the authenticated user's role.
- **Product Creation Fix**: Corrected the product type ENUM mismatch (`consomable` -> `goods`, `software`) in `ProductForm.jsx` to ensure successful backend creation for Admin users.

### [2026-02-08] Critical Admin Creation & Schema Fixes
- **Unified Password Column**: Standardized the `users` table to use `password_hash` across both Port 5000 and Port 3001 servers. Fixed Port 3001's auth routes which were previously broken after the schema migration.
- **Secured Product Management**: Integrated `protect` middleware into all product routes (`POST`, `PUT`, `DELETE`) on Port 3001, ensuring that only authenticated Admins/Staff can modify the inventory.
- **Robust Field Mapping**: Enhanced SQL queries in both `auth.js` and `products.js` to handle optional fields correctly and prevent "Unknown column" or "Invalid ENUM" errors during Admin-initiated creations.

### [2026-02-08] Admin Dashboard Stabilization
- **Fixed Creation Blockers**: Resolved 500 errors in Product, Customer, and Invoice creation by aligning SQL column names (`password_hash`), adding missing fields (`date` in invoices), and correcting camelCase/snake_case payload mismatches.
- **Port Alignment**: Standardized the backend server to default to Port 3001, ensuring seamless connectivity with the frontend's API configuration.
- **Enhanced Security**: Applied `protect` middleware to all manual creation routes, ensuring inventory and user management are strictly accessible only to authenticated session holders.

### [2026-02-08] Frontend Instrumentation & Security
- **Detailed Error Reporting**: Updated `ProductForm`, `SubscriptionManager`, `InvoiceForm`, and `CustomerForm` to alert specific error messages from the backend instead of generic "Failed to create" notifications. This functionality is critical for diagnosing environment-specific failures.
- **Secured Subscriptions**: Applied `protect` middleware to the `POST /api/subscriptions` route, ensuring that subscription creation is restricted to authenticated users, matching the security protocols of other modules.
